{% extends "detail_base.html" %}
{% load static %}

{% block content %}
<!-- css -->
<link rel="stylesheet" type="text/css" href="{% static 'friend_detail.css' %}">


<!-- ****** ë³¸ë¬¸ ****** -->
<div class="fd_info an_container">
  <div class="fd_info_box">
    <p class="fd_nick an_title">{{ user.nickname }}</p>
    <p class="fd_id">{{ user.username }}</p>

    <div class="fd_char">{% include 'ch_img/ch_img.html' %}</div>

    <p class="protein">{{ user.protein }}í”„ë¡œí‹´ </p>
  </div>

  {%if target_user.username != user.username%}
    <button type="submit" class="full_btn">ê³µê²©í•˜ê¸°</button>
  {% endif %}
</div>


<!-- íŒì—… ì‹œì‘ -->
<!-- ì¡´ì¬ í•˜ì§€ ì•ŠëŠ” ì •ë³´ (0) -->
<div class="popup_box success">
  <div class="popup">
    <p class="pop_txt">ê³µê²©ì„ ì„±ê³µí•˜ì˜€ìŠµë‹ˆë‹¤. </p>
    <button type="button" class="pop_btn" onclick="location.href='../../friend_detail/{{user.author_id}}'">í™•ì¸</button>
  </div>
</div>

<!-- ì¹œêµ¬ ëª©ë¡ì— ìˆëŠ” ê²½ìš° (1) -->
<div class="popup_box fail">
  <div class="popup">
    <p class="pop_txt">ì‚¬ìš©ê°€ëŠ¥í•œ ì¿ í°ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    <button type="button" class="pop_btn">í™•ì¸</button>
  </div>
</div>

<!-- ì¶”ê°€ ì„±ê³µ (2) -->
<div class="popup_box no_protein">
  <div class="popup">
    <p class="pop_txt">ìƒëŒ€ë°©ì´ ë„ˆë¬´ ì—°ì•½í•´ìš”...<br> í•œë²ˆë§Œ ë´ì£¼ì„¸ìš”ğŸ˜¢</p>
    <button type="button" class="pop_btn">í™•ì¸</button>
  </div>
</div>
<!-- íŒì—… ë -->

{% endblock %}


{% block script %}
<script type='text/javascript'>
  // ì¹œêµ¬ ìƒì„¸í˜ì´ì§€ ì ìš© (ê¸°ë³¸ ì•„ì´ì½˜ ì„¤ì •)
  var me = '{{request.user}}'
  var friend = '{{user.username}}'
  var icon = '{{icon}}'
  
  // ê¸°ë³¸ìœ¼ë¡œ í°/ê²€ ë‘˜ë‹¤ ë³´ì´ê²Œ 
  $('#top_menu .friend_status').css('display', 'block');
  $('#top_menu .friend_status .fd_on').css('display', 'block');
  $('#top_menu .friend_status .fd_off').css('display', 'block');

  // ì¹œêµ¬ ì¶”ê°€ ì•„ì´ì½˜(ê¸°ë³¸ ìƒíƒœ)
  if(me != friend){ //ë‚´ê°€ ì•„ë‹ ë•Œ
      if (icon == 0){ //í°ìƒ‰
        $('#top_menu .friend_status .fd_on').css('display', 'none');
      }else{
        $('#top_menu .friend_status .fd_off').css('display', 'none');
        }
  }else{
    $('#top_menu .friend_status .fd_on').css('display', 'none');
    $('#top_menu .friend_status .fd_off').css('display', 'none');
  }

  // ì¹œêµ¬ì¶”ê°€ì•„ì´ì½˜ í™œì„±í™”(ì¹œêµ¬ ì¶”ê°€/ì‚­ì œ ê¸°ëŠ¥)
  $(".friend_status img").click(function(){

    var friend_name = '{{user.username}}'
    $.ajax({
      type: "POST",
      url: "{% url 'btn_add' %}",
      data: {"friend_name" : friend_name},
      dataType:'json',
      success: function (data) {
        console.log(data.icon_status)
        if(data.icon_status == '0' ){ // ì¹œêµ¬ê°€ ì¶”ê°€ / í°ìƒ‰ -> ê²€ì •
          $('#top_menu .friend_status .fd_on').css('display', 'block');
          $('#top_menu .friend_status .fd_off').css('display', 'none');
        }else{ // ì¹œêµ¬ê°€ ì‚­ì œ / ê²€ì • -> í°ìƒ‰
          $('#top_menu .friend_status .fd_on').css('display', 'none');
          $('#top_menu .friend_status .fd_off').css('display', 'block');
        }
      },
      error: function (data) { 
        console.log(friend_name)
        console.log('ì„œë²„ ì—°ê²° ì‹¤íŒ¨')
      }
    });
  

  });

  // ì—°ê²°ëœ ì£¼ì†Œ ë³€ê²½
  $('#top_menu .prev a').attr("href", "../../")
    
  // ì¹œêµ¬ ìƒì„¸í˜ì´ì§€ ì ìš© (ì¹œêµ¬ ì¶”ê°€ ë° ì¹œêµ¬ í•´ì œ)
  $(".friend_status img").click(function(){
    if($(this).hasClass("clicked")){
      $(this).siblings().addClass("clicked");
      $(this).removeClass("on clicked");
    }else{
      $(this).addClass("clicked");
      $(this).siblings().removeClass("clicked");
    }
  });


  // íŒì—…ì°½ ë„ìš°ê¸°
  $(".full_btn").click(function(){

    // ìƒíƒœê°’ì— ë§ëŠ” íŒì—… ë„ìš°ê¸°
    var user_id = '{{user.author_id}}'

    $.ajax({
      type: "POST",
      url: "{% url 'new_steal' %}",
      data: {"user_id" : user_id},
      dataType:'json',
      success: function (data) {
        console.log('aksdjalskdjlaksjdlk')
        if(data.check == '1'){
          console.log('1')
          $('.success').addClass('open');  
          $('body').addClass('pop');  
          $(this).css('z-index', '-1');
        }else if(data.check == '2'){
          console.log('2')
          $('.fail').addClass('open');  
          $('body').addClass('pop');  
          $(this).css('z-index', '-1');
        }else if(data.check == '3'){
          console.log('3')
          $('.no_protein').addClass('open');  
          $('body').addClass('pop');  
          $(this).css('z-index', '-1');
        }
      },
      error: function (data) { 
        console.log('ì„œë²„ ì—°ê²° ì‹¤íŒ¨')
      }
    });
  });

  // íŒì—… ë‹«ì„ ë•Œ 
  $(".pop_btn").click(function(){
    $('.popup_box').removeClass('open');
    $('body').removeClass('pop');
  });

</script>
{% endblock %}